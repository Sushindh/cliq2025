# Visual Guides & Diagrams

## Data Flow Diagrams

### 1. Message Sending Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER SENDS MESSAGE                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    FRONTEND                           BACKEND                    DATABASE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Input Field    â”‚             â”‚  Express Server  â”‚
â”‚                  â”‚             â”‚  Port 5000       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚                  â”‚
â”‚  â”‚ "Hi there" â”‚  â”‚             â”‚ Socket.io        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚        â†“         â”‚                     â†‘
â”‚    Enter Key     â”‚                     â”‚
â”‚        â”‚         â”‚                     â”‚
â”‚        â†“         â”‚                     â”‚
â”‚  sendMessage()   â”‚               handleMessage()
â”‚        â”‚         â”‚                     â”‚
â”‚        â†“         â”‚                     â”‚
â”‚ Create Message   â”‚                     â”‚
â”‚ Object:          â”‚                     â”‚
â”‚ {                â”‚                     â”‚
â”‚   id: 1234567890 â”‚                     â”‚
â”‚   username: User â”‚                     â”‚
â”‚   text: "Hi"     â”‚                     â”‚
â”‚   timestamp: ... â”‚                     â”‚
â”‚ }                â”‚                     â”‚
â”‚        â”‚         â”‚                     â”‚
â”‚        â†“         â”‚                     â”‚
â”‚ socket.emit()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ socket.on()
â”‚ ('message',      â”‚                     â”‚
â”‚  msgObj)         â”‚                     â”‚
â”‚        â”‚         â”‚                     â”‚
â”‚        â†“         â”‚                     â”‚
â”‚ setMessages()    â”‚                     â”‚
â”‚ (add to local    â”‚                     â”‚
â”‚  messages array) â”‚                     â”‚
â”‚        â”‚         â”‚        io.emit()    â”‚
â”‚        â†“         â”‚      ('message',   â”‚
â”‚ Re-render list   â”‚       msgObj)      â”‚
â”‚ Auto-scroll      â”‚        â”‚           â”‚
â”‚                  â”‚        â†“           â”‚
â”‚                  â”‚ Send to all
â”‚                  â”‚ connected clients
â”‚                  â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                            â†“
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  All Clients     â”‚
                      â”‚ Receive Message  â”‚
                      â”‚ Add to state     â”‚
                      â”‚ Re-render UI     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. AI Correction Flow (Main Input)

```
USER TYPES IN MAIN INPUT
        â†“
    "i shoudl"
        â†“
 handleInputChange()
        â†“
Clear previous debounce timer
        â†“
    WAIT 3 SECONDS
        â†“
 Text length >= 8? â”€â”€Noâ†’ Don't call API
        â†“ Yes
POST /api/fix-text
{text: "i shoudl"}
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SERVER-SIDE â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚1. Check rateâ”‚
    â”‚   limit     â”‚
    â”‚   (1/10)    â”‚
    â”‚        â†“    â”‚
    â”‚2. Check     â”‚
    â”‚   cache     â”‚
    â”‚   (MISS)    â”‚
    â”‚        â†“    â”‚
    â”‚3. Call      â”‚
    â”‚   Gemini    â”‚
    â”‚   API       â”‚
    â”‚        â†“    â”‚
    â”‚4. Store in  â”‚
    â”‚   cache     â”‚
    â”‚   (5min TTL)â”‚
    â”‚        â†“    â”‚
    â”‚5. Return:   â”‚
    â”‚{            â”‚
    â”‚ original:   â”‚
    â”‚ "i shoudl"  â”‚
    â”‚ corrected:  â”‚
    â”‚ "I should"  â”‚
    â”‚}            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
  Frontend receives
        â†“
  setCorrection()
        â†“
  Show blue popup:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ’¡ Suggested:        â”‚
  â”‚ I should             â”‚
  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚ â”‚     Use        â”‚   â”‚
  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
  User clicks "Use"
        â†“
  acceptCorrection()
        â†“
  setInput("I should")
        â†“
  Input field updated
        â†“
  User can now press Enter to send
```

### 3. AI Draft Assistant Flow (Inline Suggestions)

```
OPEN DRAFT ASSISTANT
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Draft Panel (Right)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ AI Draft Assistant  [X] â”‚
â”‚                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Start typing...      â”‚   â”‚
â”‚ â”‚                      â”‚   â”‚
â”‚ â”‚ (textarea)           â”‚   â”‚
â”‚ â”‚                      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    USER TYPES
        â†“
"I shoudl meet"
        â†“
 handleTextareaChange()
        â†“
Extract current sentence:
  lastBreak = Math.max(
    text.lastIndexOf('.'),
    text.lastIndexOf('\n')
  )
  currentSentence = 
    text.substring(lastBreak+1, cursor)
  
  = "I shoudl meet"
        â†“
    WAIT 1.5 SECONDS
        â†“
POST /api/fix-text
{text: "I shoudl meet"}
        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Server processes â”‚
        â”‚ (same as above)  â”‚
        â”‚ Returns:         â”‚
        â”‚ "I should meet"  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Frontend receives
        â†“
Show inline popup:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ Suggestion:           â”‚
â”‚ I should meet            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Tab â”‚        â”‚ Dismiss â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
  USER PRESSES TAB
        â†“
acceptInlineRecommendation()
        â†“
Merge suggestion into textarea:
  newText = text.substring(0, lastBreak+1)
          + " " + suggestion
          + text.substring(cursor)
        â†“
Textarea updates:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ I should meet[cursor]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Clear suggestion popup
        â†“
Continue typing next sentence
        â†“
Repeat for next sentence...
```

---

## Component Hierarchy

```
App (Main Container)
â”œâ”€â”€ useEffect: Socket.io setup
â”œâ”€â”€ useState: 
â”‚   â”œâ”€â”€ messages
â”‚   â”œâ”€â”€ input
â”‚   â”œâ”€â”€ correction
â”‚   â”œâ”€â”€ isAIDraftOpen
â”‚   â””â”€â”€ editingMessageId
â”‚
â”œâ”€â”€ Sidebar
â”‚   â”œâ”€â”€ Channel name
â”‚   â”œâ”€â”€ Member count
â”‚   â””â”€â”€ Pro tips
â”‚
â”œâ”€â”€ ChatHeader
â”‚   â”œâ”€â”€ Title
â”‚   â”œâ”€â”€ Member count
â”‚   â””â”€â”€ [AI Draft Button]
â”‚
â”œâ”€â”€ MessageList
â”‚   â”œâ”€â”€ Map messages
â”‚   â”œâ”€â”€ Message (each)
â”‚   â”‚   â”œâ”€â”€ Avatar
â”‚   â”‚   â”œâ”€â”€ Username
â”‚   â”‚   â”œâ”€â”€ Text
â”‚   â”‚   â”œâ”€â”€ Timestamp
â”‚   â”‚   â”œâ”€â”€ Hover actions
â”‚   â”‚   â”‚   â””â”€â”€ [Fix with AI]
â”‚   â”‚   â””â”€â”€ Reactions
â”‚   â””â”€â”€ Auto-scroll
â”‚
â”œâ”€â”€ InputBar
â”‚   â”œâ”€â”€ Input field
â”‚   â”œâ”€â”€ [Send button]
â”‚   â””â”€â”€ Correction popup (conditional)
â”‚       â”œâ”€â”€ Lightbulb icon
â”‚       â”œâ”€â”€ Suggestion text
â”‚       â””â”€â”€ [Use button]
â”‚
â””â”€â”€ AIDraftAssistant (conditional)
    â”œâ”€â”€ Header
    â”‚   â”œâ”€â”€ Title
    â”‚   â””â”€â”€ [X button]
    â”œâ”€â”€ Tips section
    â”œâ”€â”€ Textarea
    â”œâ”€â”€ Inline suggestion (conditional)
    â”‚   â”œâ”€â”€ Lightbulb icon
    â”‚   â”œâ”€â”€ Suggestion text
    â”‚   â”œâ”€â”€ Loading spinner
    â”‚   â””â”€â”€ [Accept (Tab)] [Dismiss (Esc)]
    â”œâ”€â”€ Character counter
    â””â”€â”€ [Send to Channel button]
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Component State                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ messages: []                               â”‚
â”‚ â”œâ”€ [{id, username, text, timestamp}, ...] â”‚
â”‚                                            â”‚
â”‚ input: ""                                  â”‚
â”‚ â”œâ”€ Main message input value                â”‚
â”‚                                            â”‚
â”‚ correction: null | string                  â”‚
â”‚ â”œâ”€ AI suggestion for main input            â”‚
â”‚                                            â”‚
â”‚ isLoadingCorrection: false | true          â”‚
â”‚ â”œâ”€ Loading state for API call              â”‚
â”‚                                            â”‚
â”‚ isAIDraftOpen: false | true                â”‚
â”‚ â”œâ”€ Draft panel visibility                  â”‚
â”‚                                            â”‚
â”‚ editingMessageId: null | number            â”‚
â”‚ â”œâ”€ Which message is being fixed            â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Passed as Props to
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Child Components                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ MessageList                                  â”‚
â”‚ â”œâ”€ messages: []                              â”‚
â”‚ â”œâ”€ editingMessageId: null | number           â”‚
â”‚ â””â”€ onFixMessage: function                    â”‚
â”‚                                              â”‚
â”‚ InputBar                                     â”‚
â”‚ â”œâ”€ input: ""                                 â”‚
â”‚ â”œâ”€ correction: null | string                 â”‚
â”‚ â”œâ”€ isLoadingCorrection: bool                 â”‚
â”‚ â”œâ”€ onInputChange: function                   â”‚
â”‚ â”œâ”€ onSendMessage: function                   â”‚
â”‚ â””â”€ onAcceptCorrection: function              â”‚
â”‚                                              â”‚
â”‚ AIDraftAssistant                             â”‚
â”‚ â”œâ”€ isOpen: bool                              â”‚
â”‚ â”œâ”€ onClose: function                         â”‚
â”‚ â””â”€ onSendMessage: function                   â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request/Response Cycle

### POST /api/fix-text - Success Path

```
Frontend                Backend                Gemini API
  â”‚                       â”‚                        â”‚
  â”œâ”€ POST with text â”€â”€â”€â”€â”€â†’â”‚                        â”‚
  â”‚                       â”‚                        â”‚
  â”‚                    Request                     â”‚
  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
  â”‚                  â”‚1. Rate checkâ”‚               â”‚
  â”‚                  â”‚   1/10 OK   â”‚               â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                  â”‚2. Cache hit?â”‚               â”‚
  â”‚                  â”‚   No, call  â”‚               â”‚
  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
  â”‚                       â”‚                        â”‚
  â”‚                       â”œâ”€â”€â”€ POST /generate â”€â”€â”€â†’ â”‚
  â”‚                       â”‚                        â”‚
  â”‚                       â”‚  Prompt: "Fix this"    â”‚
  â”‚                       â”‚  Text: "i shoudl"      â”‚
  â”‚                       â”‚                        â”‚
  â”‚                       â”‚  Processing...         â”‚
  â”‚                       â”‚                        â”‚
  â”‚                    Response                    â”‚
  â”‚                       â”‚â†â”€â”€ Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                       â”‚  "I should"            â”‚
  â”‚                       â”‚                        â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
  â”‚                    â”‚3. Cache it   â”‚            â”‚
  â”‚                    â”‚   (5 min)    â”‚            â”‚
  â”‚                    â”‚4. Return 200 â”‚            â”‚
  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
  â”‚                       â”‚                        â”‚
  â”‚â†â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
  â”‚ {                     â”‚                        â”‚
  â”‚   "original": "...",  â”‚                        â”‚
  â”‚   "corrected": "..."  â”‚                        â”‚
  â”‚ }                     â”‚                        â”‚
  â”‚                       â”‚                        â”‚
  â”œâ”€ Show suggestion     â”‚                        â”‚
  â”‚  popup               â”‚                        â”‚
  â”‚                      â”‚                        â”‚
```

### POST /api/fix-text - Rate Limit Path

```
Frontend                Backend
  â”‚                       â”‚
  â”œâ”€ POST with text â”€â”€â”€â”€â”€â†’â”‚
  â”‚                       â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    â”‚1. Rate check â”‚
  â”‚                    â”‚   10/10 FAIL!â”‚
  â”‚                    â”‚2. Return 429 â”‚
  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                       â”‚
  â”‚â†â”€ 429 Too Many â”€â”€â”€â”€â”€â”€â”¤
  â”‚   {                   â”‚
  â”‚     "error": "Rate    â”‚
  â”‚     limit exceeded"   â”‚
  â”‚   }                   â”‚
  â”‚                       â”‚
  â”œâ”€ Suppress error in UIâ”‚
  â”‚  (don't show ugly    â”‚
  â”‚   message to user)   â”‚
  â”‚                       â”‚
  â”œâ”€ Try again after     â”‚
  â”‚  60 seconds          â”‚
  â”‚                       â”‚
```

---

## Keyboard Shortcut Flowchart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User in Draft Assistant                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Typing text...                           â”‚
â”‚ (suggestion appears)                     â”‚
â”‚                                          â”‚
â”‚ Popup visible:                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ â”‚ ğŸ’¡ Suggestion         â”‚               â”‚
â”‚ â”‚ I should meet         â”‚               â”‚
â”‚ â”‚ [Accept(Tab)][Dismiss]â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”œâ”€ User presses TAB
              â”‚        â”‚
              â”‚        â†“
              â”‚  handleKeyDown()
              â”‚        â”‚
              â”‚        â”œâ”€ e.key === 'Tab'?
              â”‚        â”‚        Yes â†“
              â”‚        â”‚  e.preventDefault()
              â”‚        â”‚        â”‚
              â”‚        â”‚        â†“
              â”‚        â”‚  acceptInlineRecommendation()
              â”‚        â”‚        â”‚
              â”‚        â”‚        â”œâ”€ Merge suggestion
              â”‚        â”‚        â”œâ”€ Update textarea
              â”‚        â”‚        â”œâ”€ Focus textarea
              â”‚        â”‚        â””â”€ Clear popup
              â”‚        â”‚
              â”‚        â””â”€ No, check ESC
              â”‚              
              â”œâ”€ User presses ESC
              â”‚        â”‚
              â”‚        â†“
              â”‚  handleKeyDown()
              â”‚        â”‚
              â”‚        â”œâ”€ e.key === 'Escape'?
              â”‚        â”‚        Yes â†“
              â”‚        â”‚  e.preventDefault()
              â”‚        â”‚        â”‚
              â”‚        â”‚        â†“
              â”‚        â”‚  dismissInlineRecommendation()
              â”‚        â”‚        â”‚
              â”‚        â”‚        â””â”€ Clear popup
              â”‚        â”‚            (no action)
              â”‚        â”‚
              â”‚        â””â”€ No other action
              â”‚
              â”œâ”€ User types next char
              â”‚        â”‚
              â”‚        â†“
              â”‚  New suggestion analysis
              â”‚  starts (for new sentence)
              â”‚
```

---

## Cache Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request Comes In                           â”‚
â”‚ text: "hello world"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Cache                                â”‚
â”‚ cache.corrections.has("hello world")?      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚          â”‚
   YES         NO
    â”‚          â”‚
    â†“          â†“
 CACHE HIT   CACHE MISS
    â”‚          â”‚
    â”‚          â”œâ”€ Call Gemini API
    â”‚          â”‚
    â”‚          â”œâ”€ Get result:
    â”‚          â”‚  "Hello, world"
    â”‚          â”‚
    â”‚          â”œâ”€ Store in cache:
    â”‚          â”‚  Map.set(
    â”‚          â”‚    "hello world",
    â”‚          â”‚    "Hello, world"
    â”‚          â”‚  )
    â”‚          â”‚
    â”‚          â”œâ”€ Set timer:
    â”‚          â”‚  setTimeout(() => {
    â”‚          â”‚    cache.delete(key)
    â”‚          â”‚  }, 5 * 60 * 1000)
    â”‚          â”‚
    â”‚          â†“
    â”‚       Return
    â”‚       result
    â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 5 minutes   â”‚
    â”‚   later...  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    Cache expires
    Same text will
    call API again
```

---

## Real-Time Sync (Multiple Users)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Server (Express + Socket.io)              â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚   â”‚ io.on()      â”‚                                           â”‚
â”‚   â”‚ connection   â”‚                                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚         â†‘                                                    â”‚
â”‚         â”‚ (multiple socket connections)                     â”‚
â”‚         â”‚                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ io.on('message', (msg) => {                â”‚            â”‚
â”‚   â”‚   messages.push(msg);                      â”‚            â”‚
â”‚   â”‚   io.emit('message', msg); â† Broadcast    â”‚            â”‚
â”‚   â”‚ })                                         â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â†‘                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Broadcast to ALL connected clients         â”‚
    â”‚                                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤
    â”‚                  â”‚                    â”‚    â”‚
    â†“                  â†“                    â†“    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client A   â”‚   â”‚ Client B   â”‚   â”‚ Client C   â”‚
â”‚ (Browser)  â”‚   â”‚ (Browser)  â”‚   â”‚ (Browser)  â”‚
â”‚            â”‚   â”‚            â”‚   â”‚            â”‚
â”‚ socket.on()â”‚   â”‚ socket.on()â”‚   â”‚ socket.on()â”‚
â”‚('message') â”‚   â”‚('message') â”‚   â”‚('message') â”‚
â”‚            â”‚   â”‚            â”‚   â”‚            â”‚
â”‚ setMessagesâ”‚   â”‚ setMessagesâ”‚   â”‚ setMessagesâ”‚
â”‚ ([...])    â”‚   â”‚ ([...])    â”‚   â”‚ ([...])    â”‚
â”‚            â”‚   â”‚            â”‚   â”‚            â”‚
â”‚ Re-render  â”‚   â”‚ Re-render  â”‚   â”‚ Re-render  â”‚
â”‚ UI         â”‚   â”‚ UI         â”‚   â”‚ UI         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Display: â”‚   â”‚ Display: â”‚   â”‚ Display: â”‚
â”‚ "Hi from â”‚   â”‚ "Hi from â”‚   â”‚ "Hi from â”‚
â”‚  A"      â”‚   â”‚  A"      â”‚   â”‚  A"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flowchart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Request Made â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Response Status?â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
    â”‚    â”‚    â”‚    â”‚
   200   400  429  500
    â”‚    â”‚    â”‚    â”‚
    â†“    â†“    â†“    â†“
  OK   Invalid Rate  Server
      Key   Limit   Error
       â”‚     â”‚      â”‚
       â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
       â”‚     â”‚      â”‚
       â†“     â†“      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Handle Error        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ 400: "Invalid API   â”‚
    â”‚      key. Update    â”‚
    â”‚      .env and       â”‚
    â”‚      restart"       â”‚
    â”‚                     â”‚
    â”‚ 429: "Rate limited. â”‚
    â”‚      Wait 60s"      â”‚
    â”‚                     â”‚
    â”‚ 500: "Service       â”‚
    â”‚      unavailable.   â”‚
    â”‚      Try again"     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    Log to console
    Show user message
    Continue gracefully
```

---

**Diagram Version:** 1.0  
**Last Updated:** 2024  
**Format:** ASCII Diagrams for Terminal Viewing

